# Investigation Report: Innowave ↔ Marine Program Match Discrepancy

**Date:** 2026-01-26
**Investigator:** Algorithm debugging session
**User:** Kim Byung-jin (kbj20415@gmail.com) at Innowave (이노웨이브)
**Status:** ROOT CAUSE IDENTIFIED + FIX APPLIED

---

## 1. Problem Statement

| Environment | Behavior |
|-------------|----------|
| **Production** | Marine program ("2026년도 국제해양환경규제 대응 친환경 선박평형수처리기술 고도화...") matches Innowave with **66 points** |
| **Local** | Same program does **NOT** match Innowave |

---

## 2. Investigation Data Collected

### 2.1 Marine Program (Local DB)
| Field | Value |
|-------|-------|
| ID | `f9aeed95-e683-4210-b5a2-5e720e17c3b7` |
| Title | 2026년도 국제해양환경규제 대응 친환경 선박평형수처리기술 고도화 및 미세플라스틱 포집기술 개발사업 |
| Ministry | 해양수산부 |
| **Category** | **NULL** (critical) |
| Keywords | 선박평형수처리설비, BWMS, 미세플라스틱, 막여과, 해양환경규제, IMO, 외래수중생물, MP저감, 친환경 |
| TRL Range | null-null (no restriction) |
| Target Type | COMPANY, RESEARCH_INSTITUTE, UNIVERSITY |
| Business Structures | (no restriction) |
| Budget | ₩9,500,000,000 |
| Deadline | 2026-02-23 (active) |

### 2.2 Innowave Organization (Local DB)
| Field | Value |
|-------|-------|
| ID | `a592e75b-9049-4352-a36c-991642cd4672` |
| Name | 이노웨이브 |
| **industrySector** | **ICT** |
| keyTechnologies | ["AI 기반 사용자 맞춤형 SaaS", "사용자 맞춤형 컨텐츠 제공 SaaS(추천/개인화)"] |
| technologyDomainsSpecific | ["AI(LLM)기반 사용자 맞춤형 추천 시스템(개인화 및 랭킹)", "AI(LLM) 응용 SW(소프트웨어)개발"] |
| TRL / targetResearchTRL | 8 / 4 |
| Type | COMPANY |
| collaborationCount | 1 |
| rdExperience | true |

### 2.3 Local Match Status
- **0 matches** between Innowave and marine program
- Innowave has **7 total matches** (scores: 93, 93, 82, 71, 65, 65, 62)
- All matches created at 2026-01-26 02:03:14 (AFTER v4.2 commit)

### 2.4 Algorithm Version History
- **v4.2 committed:** 2026-01-26 at 01:22 (commit `f89f31b`)
- **v4.2 purpose:** Reduce cross-industry false positives (specifically ICT→MARINE)
- **Production deployment:** Not yet deployed (committed today)

---

## 3. Root Cause Analysis

### Root Cause #1: Stale Production Match (CONFIRMED)
The production match (66 points) was generated by an **older algorithm** (pre-v4.2) before the keyword overlap requirement was added.

- v4.2 was committed today at 01:22 and hasn't been deployed to production
- Production still runs the older algorithm which allows ICT→MARINE matches without keyword overlap
- The match persists in the `funding_matches` table from the older generation run

### Root Cause #2: Null-Category Bypass Bug (CRITICAL BUG)
Even after v4.2 deployment, the industry filter would be **BYPASSED** because `program.category` is NULL.

**Bug location:** `lib/matching/algorithm.ts:491`
```typescript
if (!bypassIndustryFilterForSME && organization.industrySector && program.category) {
```

When `program.category` is null (as for the marine program), this condition is `false`, causing:
- Relevance threshold (0.45) → **NOT checked**
- Keyword overlap requirement → **NOT applied**
- Industry compatibility → **NOT verified**

The entire v4.2 filter block (lines 491-549) is skipped.

### Root Cause #3: Dual Relevance Matrix Inconsistency
Two different relevance matrices exist in the codebase:

| Matrix | File | ICT→MARINE Score |
|--------|------|-----------------|
| `INDUSTRY_RELEVANCE` | taxonomy.ts:347 | **0.6** (explicit) |
| `INDUSTRY_CROSS_RELEVANCE` | keyword-classifier.ts:384 | **0.2** (default, not in matrix) |

The scoring function (`scoreKeywordIndustryMatch`) uses keyword-classifier.ts → 0.2 relevance.
The industry filter uses taxonomy.ts → 0.6 relevance.

**Score impact:**
- Old algorithm: keywordScore = round(25 × 0.6) = **15 points** → total ~66
- New algorithm: keywordScore = round(25 × 0.2) = **5 points** → total ~52

With user's minimum threshold of 60, the local score (52) is filtered out.

---

## 4. Algorithm Trace (Local v4.2)

Marine program passes through these filters:

| # | Filter | Result | Reason |
|---|--------|--------|--------|
| 1 | Status = ACTIVE | ✅ PASS | Program is active |
| 2 | Deadline not expired | ✅ PASS | 2026-02-23 > today |
| 3 | Consolidated announcement | ✅ PASS | Has deadline + budget |
| 4 | Training program | ✅ PASS | No training keywords |
| 5 | Target type | ✅ PASS | COMPANY in targetType |
| 6 | Business structure | ✅ PASS | No restriction |
| 7 | TRL range | ✅ PASS | No TRL restriction |
| 8 | Hospital program | ✅ PASS | No hospital keywords |
| 9 | SME scale/region | ✅ SKIP | Ministry ≠ 중소벤처기업부 |
| 10 | **Industry filter** | ⚠️ **SKIPPED** | **`program.category` is NULL** |
| 11 | Eligibility check | ✅ PASS | No hard requirements |
| 12 | Score calculation | Score ~52 | Low keyword relevance (0.2) |
| 13 | **Minimum threshold** | ❌ **BLOCKED** | **52 < 60 (user setting)** |

---

## 5. Fix Applied

### Fix 1: Null-Category Fallback (algorithm.ts)
Use keyword classification as fallback when `program.category` is null:

```typescript
// Before (buggy):
if (!bypassIndustryFilterForSME && organization.industrySector && program.category) {
  const orgSector = findIndustrySector(organization.industrySector);
  const programSector = findIndustrySector(program.category);

// After (fixed):
if (!bypassIndustryFilterForSME && organization.industrySector) {
  const orgSector = findIndustrySector(organization.industrySector);
  let programSector: string | null = null;
  if (program.category) {
    programSector = findIndustrySector(program.category);
  }
  // Fallback: use keyword classification when category is null
  if (!programSector) {
    const fallbackClassification = classifyProgram(program.title, null, program.ministry || null);
    programSector = findIndustrySector(fallbackClassification.industry) || fallbackClassification.industry;
  }
```

### Fix 2: Cross-Relevance Matrix (keyword-classifier.ts)
Added explicit ICT ↔ MARINE entries to prevent inconsistent default scores:

```typescript
'ICT': {
  'MARINE_FISHERIES': 0.2,  // No overlap: SaaS/AI ↔ 선박/수산
  'MARINE_SECURITY': 0.2,   // No overlap: SaaS/AI ↔ VTS/해양안전
  // ... existing entries
}
```

---

## 6. Hypothesis Evaluation

| # | Hypothesis | Verdict | Evidence |
|---|------------|---------|----------|
| 1 | Algorithm version mismatch | ✅ **CONFIRMED** | v4.2 committed today, not deployed to production |
| 2 | Program data missing locally | ❌ **DISPROVED** | Marine program exists locally with 1903 total programs |
| 3 | Profile data difference | ❌ **DISPROVED** | Innowave profile identical (ICT, AI SaaS keywords) |
| — | **NEW: Null-category bypass** | ✅ **CONFIRMED** | `program.category` is NULL, bypasses entire filter |
| — | **NEW: Dual relevance matrix** | ✅ **CONFIRMED** | taxonomy.ts (0.6) vs keyword-classifier.ts (0.2) |

---

## 7. Recommended Actions

1. **Deploy v4.2 + null-category fix** → Production will correctly block ICT→MARINE matches
2. **Regenerate matches for Innowave** → Stale 66-point match will be replaced
3. **Audit other null-category programs** → Check how many programs have null category
4. **Consider backfilling categories** → Use keyword classification to populate null categories
