# PostgreSQL Standby Server Configuration
# Connect Platform - Hot Standby for High Availability
# Target: 99.9% uptime during peak season (Jan-March 2026)

# Port (different for local testing, same for production)
port = 5433                              # 5432 for production standby

# Connection Settings
listen_addresses = '*'
max_connections = 200

# Memory Settings (Dev: 16-64GB Mac | Production: 128GB i9-12900K)
# For development Mac, use smaller values. Uncomment production values when deploying.
shared_buffers = 4GB                     # Dev: 4GB | Prod: 32GB (25% of RAM)
effective_cache_size = 16GB              # Dev: 16GB | Prod: 64GB (50% of RAM)
work_mem = 128MB                         # For sorting/hashing
maintenance_work_mem = 1GB               # Dev: 1GB | Prod: 2GB (for VACUUM, CREATE INDEX)

# Hot Standby Settings
hot_standby = on                         # Allow read queries
hot_standby_feedback = on                # Prevent query conflicts
max_standby_streaming_delay = 30s        # Max lag before canceling queries

# Replication Settings
# Note: primary_conninfo is set in postgresql.auto.conf by pg_basebackup
primary_slot_name = 'standby_slot'
promote_trigger_file = '/tmp/postgresql.trigger.5433'

# Logging
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-standby-%Y-%m-%d_%H%M%S.log'
log_line_prefix = '%m [%p] STANDBY %u@%d '
log_min_duration_statement = 1000

# Performance
random_page_cost = 1.1                   # SSD-optimized
# effective_io_concurrency = 200         # Linux-only (SSD parallel I/O) - not supported on macOS
