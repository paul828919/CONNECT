# PostgreSQL Primary Server Configuration for Streaming Replication
# Connect Platform - Production HA Setup
# Target: 99.9% uptime during peak season (Jan-March 2026)

# Connection Settings
listen_addresses = '*'
port = 5432
max_connections = 200

# Memory Settings (Dev: 16-64GB Mac | Production: 128GB i9-12900K)
# For development Mac, use smaller values. Uncomment production values when deploying.
shared_buffers = 4GB                     # Dev: 4GB | Prod: 32GB (25% of RAM)
effective_cache_size = 16GB              # Dev: 16GB | Prod: 64GB (50% of RAM)
work_mem = 128MB                         # For sorting/hashing
maintenance_work_mem = 1GB               # Dev: 1GB | Prod: 2GB (for VACUUM, CREATE INDEX)

# WAL Settings (Write-Ahead Logging for Replication)
wal_level = replica                      # Enable replication
max_wal_senders = 10                     # Max replication connections
wal_keep_size = 1GB                      # Keep 1GB of WAL files
max_replication_slots = 10               # Replication slot limit

# Checkpoint Settings
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9
max_wal_size = 4GB
min_wal_size = 1GB

# Logging
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_line_prefix = '%m [%p] %u@%d '
log_min_duration_statement = 1000        # Log slow queries (>1s)
log_replication_commands = on

# Performance
random_page_cost = 1.1                   # SSD-optimized
# effective_io_concurrency = 200         # Linux-only (SSD parallel I/O) - not supported on macOS

# Replication
hot_standby = on                         # Allow reads on standby
hot_standby_feedback = on                # Prevent query conflicts
